<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:az="http://java.sun.com/jsf/composite/comp">

    <h:head>
        <link rel="stylesheet" type="text/css" href="../styles/main.css" />
        <link rel="stylesheet" type="text/css" href="../styles/exp-builder.css" />
        <link rel="stylesheet" type="text/css" href="../styles/icons.css" />

        <script language="javascript">
            
        </script>

    </h:head>
    <body>
        <az:labHeader/>

        <h:form id="form">           
            <table class="exp-builder">
                <tr>
                    <td class="exp-builder-title" colspan="2">
                        <table>
                            <tr>
                                <td>
                                    <img src="/Az/images/icons/experiment-builder-logo.png"/>
                                </td>
                                <td>
                                    <h:outputText  value="Create new experiment" styleClass="page-title"/>
                                </td>
                            </tr>
                        </table>

                    </td>
                </tr>
                <tr>
                    <td class="exp-builder-left">
                        <h:outputText class="exp-builder-tests-title" value="Tests:"/>
                        <table style="width: 100%; padding-top: 10px;">
                            <tr>
                                <td  style="width: 50px;">
                                    <p:commandButton styleClass="exp-builder-add-test" update=":form" value="Add&nbsp;Sync&nbsp;Test" action="#{experimentBuilder.addNewSyncTest()}" icon="add-test-icon"/>
                                </td>
                                <td style="width: 100%">
                                    <p:commandButton styleClass="exp-builder-add-test" update=":form" value="Add&nbsp;Async&nbsp;Test" action="#{experimentBuilder.addNewAsyncTest()}" icon="add-test-icon"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" style="width: 100%; vertical-align: top;">
                                    <p:dataTable style="width: 100%; padding-top: 10px;" styleClass="exp-builder-table" value="#{experimentBuilder.tests}" var="test" paginator="true" rows="7" 
                                                 selection="#{experimentBuilder.currentTest}" selectionMode="single" rowKey="#{test.id}">  
                                        <p:ajax event="rowSelect" update=":form" />  
                                        <p:column headerText="Name">  
                                            #{test.name}  
                                        </p:column>  
                                        <p:column headerText="Type">  
                                            #{test.type}  
                                        </p:column>  
                                    </p:dataTable>
                                </td>   
                            </tr>
                        </table>
                    </td>
                    <td class="exp-builder-middle" style="vertical-align: top; height: 100%">
                        <p:accordionPanel styleClass="exp-builder-accordion" id="cont" multiple="false" dynamic="false" activeIndex="-1">  
                            <p:tab id="agents" title="Agents">  
                                <p:dataTable styleClass="exp-builder-table" value="#{experimentBuilder.currentTest.agents}" var="agent" paginator="true" rows="10"  
                                             selection="#{experimentBuilder.selectedAgent}" selectionMode="single" rowKey="#{agent.id}">  
                                    <p:ajax event="rowSelect" update=":form"/>  
                                    <p:column>  
                                        #{agent.name}  
                                    </p:column>  
                                </p:dataTable>
                                <p:commandButton value="Remove" action="#{experimentBuilder.removeAgent}" update=":form"/>
                                <p:commandButton value="Add" update=":form" onclick="agentsDlg.show()"/>
                            </p:tab>  
                            <p:tab id="generators" title="Problem generator">  
                                <p:dataTable styleClass="exp-builder-table" value="#{experimentBuilder.currentTest.problemGenerators}" var="gen" paginator="false" rows="1"  
                                             selection="#{experimentBuilder.selectedProblemGenerator}" selectionMode="single" rowKey="#{gen.id}">  
                                    <p:ajax event="rowSelect" update=":form"/>  
                                    <p:column>  
                                        #{gen.name}  
                                        <p:commandButton value="Remove" action="#{experimentBuilder.removeProblemGen}" update=":form"/>
                                        <p:commandButton value="Replace" onclick="gensDlg.show()" update=":form"/>
                                    </p:column>  
                                </p:dataTable>
                                <p:commandButton value="Add" onclick="gensDlg.show()" update=":form" disabled="#{!experimentBuilder.problemGen}"/>
                            </p:tab>  
                            <p:tab id="stats" title="Statistic collectors">  
                                <p:dataTable styleClass="exp-builder-table" value="#{experimentBuilder.currentTest.statisticCollectors}" var="stat" paginator="true" rows="10"  
                                             selection="#{experimentBuilder.selectedStatisticCollector}" selectionMode="single" rowKey="#{stat.id}">   
                                    <p:ajax event="rowSelect" update=":form"/>  
                                    <p:column>  
                                        #{stat.name}  
                                    </p:column>  
                                </p:dataTable>
                                <p:commandButton value="Remove" action="#{experimentBuilder.removeStatCol}" update=":form"/>
                                <p:commandButton value="Add" update=":form" onclick="statsDlg.show()"/>
                            </p:tab>  
                            <p:tab id="testers" title="Correctness tester">  
                                <p:dataTable styleClass="exp-builder-table" value="#{experimentBuilder.currentTest.correctnessTesters}" var="tester" paginator="false" rows="1"  
                                             selection="#{experimentBuilder.selectedCorrectnessTester}" selectionMode="single" rowKey="#{tester.id}">  
                                    <p:ajax event="rowSelect" update=":form"/>  
                                    <p:column>  
                                        #{tester.name}  
                                        <p:commandButton value="Remove" action="#{experimentBuilder.removeCorrectTester}" update=":form"/>
                                        <p:commandButton value="Replace" onclick="testersDlg.show()" update=":form"/>
                                    </p:column>  
                                </p:dataTable>
                                <p:commandButton value="Add" onclick="testersDlg.show()" update=":form" disabled="#{!experimentBuilder.correctTester}"/>
                            </p:tab>  
                            <p:tab id="delayers" title="Message Delayer">  
                                <p:dataTable styleClass="exp-builder-tab" value="#{experimentBuilder.currentTest.messageDelayers}" var="delayer" rows="1" paginator="false" 
                                             selection="#{experimentBuilder.selectedMessageDelayer}" selectionMode="single" rowKey="#{delayer.id}">  
                                    <p:ajax event="rowSelect" update=":form"/>  
                                    <p:column>  
                                        #{delayer.name}  
                                        <p:commandButton value="Remove" action="#{experimentBuilder.removeMsgDelayer}" update=":form"/>
                                        <p:commandButton value="Replace" onclick="delayersDlg.show()" update=":form"/>
                                    </p:column>  
                                </p:dataTable>
                                <p:commandButton value="Add" onclick="delayersDlg.show()" update=":form" disabled="#{!experimentBuilder.msgDelayer}"/>
                            </p:tab>  
                            <p:tab id="limiters" title="Limiter">  
                                <p:dataTable styleClass="exp-builder-table" value="#{experimentBuilder.currentTest.limiters}" var="limiter" rows="1" paginator="false" 
                                             selection="#{experimentBuilder.selectedLimiter}" selectionMode="single" rowKey="#{limiter.id}">  
                                    <p:ajax event="rowSelect" update=":form"/>  
                                    <p:column>  
                                        #{limiter.name}  
                                        <p:commandButton value="Remove" action="#{experimentBuilder.removeLimiter}" update=":form"/>
                                        <p:commandButton value="Replace" onclick="limitersDlg.show()" update=":form"/>
                                    </p:column>  
                                </p:dataTable>
                                <p:commandButton value="Add" onclick="limitersDlg.show()" update=":form" disabled="#{!experimentBuilder.limiter}"/>
                            </p:tab>  
                        </p:accordionPanel> 
                    </td>
                    <td class="exp-builder-right">
                        <p:dataTable styleClass="exp-builder-table" var="variable" value="#{experimentBuilder.selectedCode.variables}" id="variables" editable="true">  

                            <f:facet name="header">  
                                #{experimentBuilder.selectedCode.name} Variables  
                            </f:facet>  

                            <p:column headerText="Name" style="width:125px">  
                                <span>#{variable.name}</span> 
                            </p:column>  

                            <p:column headerText="Value" style="width:125px">  
                                <p:cellEditor>  
                                    <f:facet name="output">  
                                        <h:outputText value="#{variable.defaultValue}" />  
                                    </f:facet>  
                                    <f:facet name="input">  
                                        <p:inputText value="#{variable.defaultValue}" style="width:100%" label="value"/>  
                                    </f:facet>  
                                </p:cellEditor>  
                            </p:column>  
                            <p:column>  
                                <p:rowEditor />  
                            </p:column> 
                        </p:dataTable>
                    </td>
                </tr>
            </table>
        </h:form>



        <p:dialog header="Available Agents" widgetVar="agentsDlg" resizable="false" >  
            <h:form>
                <h:panelGrid>  
                    <p:dataTable id="agentsTable" var="agent" value="#{experimentBuilder.agents}" widgetVar="agentsTable" 
                                 emptyMessage="No agents found with given criteria" 
                                 selection="#{experimentBuilder.selectedAgentsFromAll}" selectionMode="multiple" rowKey="#{agent.id}">  
                        <f:facet name="header">  
                            <p:outputPanel>  
                                <h:outputText value="Search all fields:" />  
                                <p:inputText id="globalAgentFilter" onkeyup="agentsTable.filter()" style="width:150px" />  
                            </p:outputPanel>  
                        </f:facet>  
                        <p:column id="nameColumn" filterBy="#{agent.name}"   
                                  headerText="Name"  
                                  filterMatchMode="contains">  
                            <h:outputText value="#{agent.name}" />  
                        </p:column>  
                        <p:column id="authorColumn" filterBy="#{agent.author.nickName}"  
                                  headerText="Author"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{agent.author.nickName}" />  
                        </p:column>  
                        <p:column id="descriptionColumn" filterBy="#{agent.description}"   
                                  headerText="Description"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{agent.description}" />  
                        </p:column>  
                        <p:column id="ratingColumn" filterBy="#{agent.rating}"   
                                  headerText="Rating"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{agent.rating}" />  
                        </p:column>  
                        <p:column id="dowNumColumn" filterBy="#{agent.numberOfDownloads}"   
                                  headerText="Num. of downloads"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{agent.numberOfDownloads}" />  
                        </p:column>  
                    </p:dataTable> 
                </h:panelGrid>  
                <p:commandButton id="addAgent" action="#{experimentBuilder.saveAgents}" value="Add Selected" update=":form" oncomplete="agentsDlg.hide();"/>  
            </h:form>
        </p:dialog>  

        <p:dialog header="Available Statistic Collectors" widgetVar="statsDlg" resizable="false" >  
            <h:form>
                <h:panelGrid>  
                    <p:dataTable id="statsTable" var="stat" value="#{experimentBuilder.statisticCollectors}" widgetVar="statsTable" 
                                 emptyMessage="No statistic collectors found with given criteria" 
                                 selection="#{experimentBuilder.selectedStatisticCollectorsFromAll}" selectionMode="multiple" rowKey="#{stat.id}">  
                        <f:facet name="header">  
                            <p:outputPanel>  
                                <h:outputText value="Search all fields:" />  
                                <p:inputText id="globalStatsFilter" onkeyup="statsTable.filter()" style="width:150px" />  
                            </p:outputPanel>  
                        </f:facet>  
                        <p:column id="nameColumn" filterBy="#{stat.name}"   
                                  headerText="Name"  
                                  filterMatchMode="contains">  
                            <h:outputText value="#{stat.name}" />  
                        </p:column>  
                        <p:column id="authorColumn" filterBy="#{stat.author.nickName}"  
                                  headerText="Author"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{stat.author.nickName}" />  
                        </p:column>  
                        <p:column id="descriptionColumn" filterBy="#{stat.description}"   
                                  headerText="Description"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{stat.description}" />  
                        </p:column>  
                        <p:column id="ratingColumn" filterBy="#{stat.rating}"   
                                  headerText="Rating"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{stat.rating}" />  
                        </p:column>  
                        <p:column id="dowNumColumn" filterBy="#{stat.numberOfDownloads}"   
                                  headerText="Num. of downloads"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{stat.numberOfDownloads}" /> 
                        </p:column>
                    </p:dataTable> 
                </h:panelGrid>  
                <p:commandButton id="addStats" action="#{experimentBuilder.saveStatisticCollectors}" value="Add Selected" update=":form" oncomplete="statsDlg.hide();"/>  
            </h:form>
        </p:dialog>  

        <p:dialog header="Available Problem Generators" widgetVar="gensDlg" resizable="false" >  
            <h:form>
                <h:panelGrid>  
                    <p:dataTable id="gensTable" var="gen" value="#{experimentBuilder.problemGenerators}" widgetVar="gensTable" 
                                 emptyMessage="No problem generators found with given criteria" selection="#{experimentBuilder.selectedProblemGenerator}" 
                                 selectionMode="single" rowKey="#{gen.id}">  
                        <f:facet name="header">  
                            <p:outputPanel>  
                                <h:outputText value="Search all fields:" />  
                                <p:inputText id="globalGensFilter" onkeyup="gensTable.filter()" style="width:150px" />  
                            </p:outputPanel>  
                        </f:facet>  
                        <p:column id="nameColumn" filterBy="#{gen.name}"   
                                  headerText="Name"  
                                  filterMatchMode="contains">  
                            <h:outputText value="#{gen.name}" />  
                        </p:column>  
                        <p:column id="authorColumn" filterBy="#{gen.author.nickName}"  
                                  headerText="Author"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{gen.author.nickName}" />  
                        </p:column>  
                        <p:column id="descriptionColumn" filterBy="#{gen.description}"   
                                  headerText="Description"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{gen.description}" />  
                        </p:column>  
                        <p:column id="ratingColumn" filterBy="#{gen.rating}"   
                                  headerText="Rating"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{gen.rating}" />  
                        </p:column>  
                        <p:column id="dowNumColumn" filterBy="#{gen.numberOfDownloads}"   
                                  headerText="Num. of downloads"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{gen.numberOfDownloads}" /> 
                        </p:column>
                    </p:dataTable> 
                </h:panelGrid>  
                <p:commandButton id="addGen" action="#{experimentBuilder.saveProblemGenerator}" value="Add Selected" update=":form" oncomplete="gensDlg.hide();"/>  
            </h:form>
        </p:dialog>  

        <p:dialog header="Available Limiters" widgetVar="limitersDlg" resizable="false" >  
            <h:form>
                <h:panelGrid>  
                    <p:dataTable id="limitersTable" var="limiter" value="#{experimentBuilder.limiters}" widgetVar="limitersTable" 
                                 emptyMessage="No limiters found with given criteria" selection="#{experimentBuilder.selectedLimiter}" 
                                 selectionMode="single" rowKey="#{limiter.id}">  
                        <f:facet name="header">  
                            <p:outputPanel>  
                                <h:outputText value="Search all fields:" />  
                                <p:inputText id="globalLimiterFilter" onkeyup="limitersTable.filter()" style="width:150px" />  
                            </p:outputPanel>  
                        </f:facet>  
                        <p:column id="nameColumn" filterBy="#{limiter.name}"   
                                  headerText="Name"  
                                  filterMatchMode="contains">  
                            <h:outputText value="#{limiter.name}" />  
                        </p:column>  
                        <p:column id="authorColumn" filterBy="#{limiter.author.nickName}"  
                                  headerText="Author"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{limiter.author.nickName}" />  
                        </p:column>  
                        <p:column id="descriptionColumn" filterBy="#{limiter.description}"   
                                  headerText="Description"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{limiter.description}" />  
                        </p:column>
                        <p:column id="ratingColumn" filterBy="#{limiter.rating}"   
                                  headerText="Rating"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{limiter.rating}" />  
                        </p:column>  
                        <p:column id="dowNumColumn" filterBy="#{limiter.numberOfDownloads}"   
                                  headerText="Num. of downloads"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{limiter.numberOfDownloads}" /> 
                        </p:column>
                    </p:dataTable> 
                </h:panelGrid>  
                <p:commandButton id="addLimiter" action="#{experimentBuilder.saveLimiter}" value="Add Selected" update=":form" oncomplete="limitersDlg.hide();"/>  
            </h:form>
        </p:dialog>  

        <p:dialog header="Available Correctness Testers" widgetVar="testersDlg" resizable="false" >  
            <h:form>
                <h:panelGrid>  
                    <p:dataTable id="testersTable" var="tester" value="#{experimentBuilder.correctnessTesters}" widgetVar="testersTable" 
                                 emptyMessage="No correctness testers found with given criteria" selection="#{experimentBuilder.selectedCorrectnessTester}" 
                                 selectionMode="single" rowKey="#{tester.id}">  
                        <f:facet name="header">  
                            <p:outputPanel>  
                                <h:outputText value="Search all fields:" />  
                                <p:inputText id="globalTesterFilter" onkeyup="testersTable.filter()" style="width:150px" />  
                            </p:outputPanel>  
                        </f:facet>  
                        <p:column id="nameColumn" filterBy="#{tester.name}"   
                                  headerText="Name"  
                                  filterMatchMode="contains">  
                            <h:outputText value="#{tester.name}" />  
                        </p:column>  
                        <p:column id="authorColumn" filterBy="#{tester.author.nickName}"  
                                  headerText="Author"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{tester.author.nickName}" />  
                        </p:column>  
                        <p:column id="descriptionColumn" filterBy="#{tester.description}"   
                                  headerText="Description"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{tester.description}" />  
                        </p:column>  
                        <p:column id="ratingColumn" filterBy="#{tester.rating}"   
                                  headerText="Rating"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{tester.rating}" />  
                        </p:column>  
                        <p:column id="dowNumColumn" filterBy="#{tester.numberOfDownloads}"   
                                  headerText="Num. of downloads"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{tester.numberOfDownloads}" /> 
                        </p:column>
                    </p:dataTable> 
                </h:panelGrid>  
                <p:commandButton id="addTester" action="#{experimentBuilder.saveCorrectnessTester}" value="Add Selected" update=":form" oncomplete="testersDlg.hide();"/>  
            </h:form>
        </p:dialog>  
        <p:dialog header="Available Message Delayers" widgetVar="delayersDlg" resizable="false" >  
            <h:form>
                <h:panelGrid>  
                    <p:dataTable id="delayersTable" var="delayer" value="#{experimentBuilder.messageDelayers}" widgetVar="delayersTable" 
                                 emptyMessage="No delayers found with given criteria" selection="#{experimentBuilder.selectedMessageDelayer}" 
                                 selectionMode="multiple" rowKey="#{delayer.id}">  
                        <f:facet name="header">  
                            <p:outputPanel>  
                                <h:outputText value="Search all fields:" />  
                                <p:inputText id="globalDelayerFilter" onkeyup="delayersTable.filter()" style="width:150px" />  
                            </p:outputPanel>  
                        </f:facet>  
                        <p:column id="nameColumn" filterBy="#{delayer.name}"   
                                  headerText="Name"  
                                  filterMatchMode="contains">  
                            <h:outputText value="#{delayer.name}" />  
                        </p:column>  
                        <p:column id="authorColumn" filterBy="#{delayer.author.nickName}"  
                                  headerText="Author"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{delayer.author.nickName}" />  
                        </p:column>  
                        <p:column id="descriptionColumn" filterBy="#{delayer.description}"   
                                  headerText="Description"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{delayer.description}" />  
                        </p:column>  
                        <p:column id="ratingColumn" filterBy="#{delayer.rating}"   
                                  headerText="Rating"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{delayer.rating}" />  
                        </p:column>  
                        <p:column id="dowNumColumn" filterBy="#{delayer.numberOfDownloads}"   
                                  headerText="Num. of downloads"
                                  filterMatchMode="contains">  
                            <h:outputText value="#{delayer.numberOfDownloads}" /> 
                        </p:column>
                    </p:dataTable> 
                </h:panelGrid>  
                <p:commandButton id="addDelayer" action="#{experimentBuilder.saveMessageDelayer}" value="Add Selected" update=":form" oncomplete="delayersDlg.hide();"/>  
            </h:form>
        </p:dialog>  
    </body>
</html>
